+++
title = "什么是WGE"
weight = 1
+++

WGE 是一个基于 C++ 的高性能 Web 应用防火墙（WAF）库。它已成功应用于商业产品：石犀 - Web 治理引擎（SR-WGE）。WGE 旨在完全兼容 OWASP 核心规则集（CRS），并可作为 ModSecurity 的直接替代品。该库采用 C++23 构建，设计目标是快速、高效且易于使用。

## 性能对比
处理器: Intel(R) Core(TM) i5-10400 CPU @ 2.90GHz   2.90 GHz  
内存: 32GB  
操作系统: Ubuntu 20.04.6 LTS (5.15.153.1-microsoft-standard-WSL2)  
工作线程: 8  
测试样本: [白样本](https://github.com/stone-rhino/wge/blob/main/benchmarks/test_data/white.data) 以及 [黑样本](https://github.com/stone-rhino/wge/blob/main/benchmarks/test_data/black.data)

| 规则集         | 内存池(TCMalloc) |ModSecurity |    WGE     |
|-------------------|------------------------------|------------|------------|
| CRS v4.3.0        |         关闭                   | 4010 QPS   | 17560 QPS  |
| CRS v4.3.0        |         开启                  | 4927 QPS   | 18864 QPS  |  

基准性能测试结果显示，WGE 的性能显著优于 ModSecurity，提升幅度超过 4 倍。这得益于现代 C++ 特性的应用以及出色的架构设计与实现。WGE 旨在易于使用并能无缝集成到现有应用程序中，是开发者为项目添加 WAF 功能的理想选择。

## 功能列表
* 完全兼容 OWASP 核心规则集（CRS）。支持所有变量、操作符和动作，确保与现有规则集的兼容性。SQL 注入（SQLI）、跨站脚本（XSS）、本地文件包含（LFI）、远程命令执行（RCE）等所有CRS支持的攻击类型均可被有效检测和防御。
* 高性能。采用Antlr4实现高性能前端解析器，精心设计的高效C++对象图作为后端解释器，并集成了TCMalloc内存池，显著提升吞吐量并降低内存碎片。
* 丰富的转码支持。使用Ragel实现的高性能DFA编解码引擎，支持常见的22种转码格式，包括URL解码、HTML实体解码、JavaScript解码、CSS解码等，确保攻击载荷无法通过编码变换绕过检测。
* 多线程支持。无锁设计，支持在多线程环境中高效运行，适用于高并发场景。
* SecLang++。在SecLang基础上衍生SecLang++，新增了多种实用的语言特性，如规则片段、以配置驱动规则、条件动作、别名、引用变量等。提升规则编写的灵活性和可维护性。

## 未来计划
* 持续演进 SecLang++，引入更多现代编程思想的语言特性，同时兼顾领域专用语言的简单易用，提升规则编写的表达力和可维护性。
* 增加流式处理支持，大请求体积数据时无需将整个请求/响应加载到内存中，降低内存使用并拒绝大请求体积攻击。
* 增加语法语义引擎，降低误报率，提升对复杂攻击的检测能力。
* 引入机器学习辅助检测，提升对未知攻击的识别能力。
* 增加多模匹配检测引擎，进一步提升规则执行效率。
* 采用字节码+JIT技术，最大限度提升规则执行效率。
* 扩展更多连接器，演示更多 Web 服务器和框架的无缝集成。